@using HaarlemFestival.Models;
@{
    /**/

    ViewBag.Title = "ManageAccounts";
}
@model List<Account>

<div class="event-banner"></div>
@{
    if (Session["Data_Added"] != null)
    {
        if ((bool)Session["Data_Added"])
        {
            <div class="basket-alert">
                <div class="alert alert-success alert-dismissable">
                    <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                    <h3>Success!</h3> The account has sucessfully been added.
                </div>
            </div>
        }

        Session["Data_Added"] = false;
    }

    if (Session["Data_Updated"] != null)
    {
        if ((bool)Session["Data_Updated"])
        {
            <div class="basket-alert">
                <div class="alert alert-success alert-dismissable">
                    <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                    <h3>Success!</h3> The account has sucessfully been updated.
                </div>
            </div>
        }

        Session["Data_Updated"] = false;
    }

    if (Session["Data_Deleted"] != null)
    {
        if ((bool)Session["Data_Deleted"])
        {
            <div class="basket-alert">
                <div class="alert alert-success alert-dismissable">
                    <a href="#" class="close" data-dismiss="alert" aria-label="close">×</a>
                    <h3>Success!</h3> The account has sucessfully been deleted.
                </div>
            </div>
        }

        Session["Data_Deleted"] = false;
    }
}


<!-- Modal Delete Data -->
<div class="modal fade" id="deletePopup" tabindex="-1" role="dialog" aria-labelledby="deletePopup">
    <div class="modal-dialog modal-lg" role="document">

        <!-- CONTENT -->
        <div class="modal-content">

            <!-- HEADER -->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="myModalLabel">Delete Data</h4>
            </div>

            <!-- BODY -->
            <div class="modal-body">
                Are you sure you want to delete this account?
            </div>

            <!-- FOOTER -->
            <div class="modal-footer">
                <button type="button" class="btn btn-success" onclick="DeleteConfirmed()"><i class="fa fa-check"></i> Yes, I am sure</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal"><i class="fa fa-times"></i> No, Take me back</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Add Data -->
<div class="modal fade" id="addPopup" tabindex="-1" role="dialog" aria-labelledby="newPopup">
    <div class="modal-dialog modal-lg" role="document">

        <!-- CONTENT -->
        <div class="modal-content">
            @{Html.RenderAction("_AddAccountPartial", "Admin");}
        </div>
    </div>
</div>

<!-- Modal Update Data -->
<div class="modal fade" id="updatePopup" tabindex="-1" role="dialog" aria-labelledby="newPopup">
    <div class="modal-dialog modal-lg" role="document">

        <!-- CONTENT -->
        <div class="modal-content">

        </div>
    </div>
</div>

<script type="text/javascript">
     function OpenUpdateForm(id) {
            $.get('@Url.Action("_UpdateData", "Admin")', { id: id, type: type }, function (form) {
                $("#updatePopup .modal-content").html(form);
                $(".errorAlert").css("display", "none");
                SetFormOptions();
            });
     }


     function OpenDeleteConfirm(id) {
            $("#deletePopup").attr("accountId", id);
     }

    function DeleteConfirmed() {
            var type = sessionStorage.getItem("type");
            var url = '@Url.Action("DeleteAccount", "Admin")';
            var accountId = $("#deletePopup").attr("accountId");

            $.post(url, { id: accountId });

            window.location.href = '@Url.Action("ManageAccounts", "Admin")';
        }

</script>

<div class="container body-content">
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Username</th>
                <th>Role</th>
                <th colspan="2"></th>
            </tr>
        </thead>
        <tbody class="eventData">
            @foreach (Account account in Model)
            {
                <tr>
                    <td>@account.Naam</td>
                    <td>@account.Username</td>
                    <td>Role</td>
                    <td><i onclick="OpenUpdateForm(@account.Id)" class="glyphicon glyphicon-pencil" data-toggle="modal" data-target="#updatePopup" href="#"></i></td>
                    <td><i onclick="OpenDeleteConfirm(@account.Id)" data-toggle="modal" data-target="#deletePopup" href="#" class="glyphicon glyphicon-remove"></i></td>
                </tr>
            }
        </tbody>
    </table>
</div>
